webpackJsonp([9],{cVov:function(e,t){},yapc:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mtWM"),r=i.n(s),a=i("HJfm"),o={data:function(){return{data2:[],defaultProps:{children:"children",label:"label"},roleName:"",roleDescription:"",standardPrice:0,renewPrice:0,state:"0",selectedPermission:[],getPermissionses:{},updateSelectedPermission:[],allPermission:{},authorization:"",token:""}},created:function(){var e=window.localStorage;this.authorization=e.getItem("userId"),this.token=e.getItem("token")},mounted:function(){"add"!=this.$route.params.key?(this.modify=this.$route.params.row,this.roleName=this.modify.roleName,this.roleDescription=this.modify.roleDescription,this.standardPrice=this.modify.standardPrice,this.renewPrice=this.modify.renewPrice,this.state=this.modify.state,this.id=this.modify.id,this.allPermission=this.modify.permissions,this.data2=this.formatData(this.modify.permissions)):this.getPermissions()},methods:{goBack:function(){this.$router.go(-1)},formatData:function(e){var t=this,i=[],s=0,r=function(r){var a={id:s+=1,label:r,children:[]};e[r].forEach(function(e){"unlock"==e.state&&t.selectedPermission.push(e.industry_id||e.enterprise_id||e.id),a.children.push({id:e.industry_id||e.enterprise_id||e.id,label:e.industry_name||e.enterprise_name||e.name});for(var i=0;i<e.length;i++);}),i.push(a)};for(var a in e)r(a);return i},getPermissions:function(){var e=this;r()({url:a.b+"/userPermission/getPermissions",method:"get",headers:{Authorization:"user-"+this.authorization+"-"+this.token}}).then(function(t){t.data.msg?e.$router.push({name:"login"}):(e.allPermission=t.data,e.data2=e.formatData(t.data))}).catch(function(e){console.log(e)})},addRole:function(){var e=this;this.getCheckedNodes(),r()({url:a.b+"/userPermission/insertOrUpdateRole",method:"post",headers:{Authorization:"user-"+this.authorization+"-"+this.token},data:{roleName:this.roleName,roleDescription:this.roleDescription,standardPrice:this.standardPrice,renewPrice:this.renewPrice,state:this.state,permissions:this.allPermission}}).then(function(t){t.data.msg?e.$router.push({name:"login"}):e.$router.push({name:"roleManagement"})}).catch(function(e){console.log(e)})},modifyRole:function(){var e=this;this.getCheckedNodes(),r()({url:a.b+"/userPermission/insertOrUpdateRole",method:"post",headers:{Authorization:"user-"+this.authorization+"-"+this.token},data:{roleName:this.roleName,roleDescription:this.roleDescription,standardPrice:this.standardPrice,renewPrice:this.renewPrice,state:this.state,permissions:this.allPermission,id:this.id}}).then(function(t){t.data.msg?e.$router.push({name:"login"}):e.$router.push({name:"roleManagement"})}).catch(function(e){console.log(e)})},getCheckedNodes:function(){this.updateSelectedPermission=this.$refs.tree.getCheckedNodes();for(var e=[],t=0;t<this.updateSelectedPermission.length;t++){var i=this.updateSelectedPermission[t].id;this.updateSelectedPermission[t].label;for(var s in this.allPermission){var r=this.allPermission[s];if("AShare_access_matrix"==s)for(var a=0;a<r.length;a++)if(r[a].industry_id==i){r[a].state="unlock";for(var o=0;o<r[a].enterprises.length;o++)r[a].enterprises[o].state="unlock";e.push(i)}else{var n=!1;for(var d in e)e[d].indexOf(r[a].industry_id)>-1&&(n=!0);if(!n){r[a].state="lock";for(var l=0;l<r[a].enterprises.length;l++)r[a].enterprises[l].state="lock"}}else if("Sentiment_access_matrix"==s)for(var c=0;c<r.length;c++)if(r[c].id==i)r[c].state="unlock",e.push(i);else{var u=!1;for(var d in e)e[d].indexOf(r[c].id)>-1&&(u=!0);u||(r[c].state="lock")}else for(var h=0;h<r.length;h++)if(i==r[h].enterprise_id)r[h].state="unlock",e.push(i);else{var m=!1;for(var d in e)e[d].indexOf(r[h].enterprise_id)>-1&&(m=!0);m||(r[h].state="lock")}}}}}},n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"role-manager-box"},["add"==this.$route.params.key?i("h2",[e._v("角色管理")]):e._e(),e._v(" "),"modify"==this.$route.params.key?i("h2",[e._v("修改角色")]):e._e(),e._v(" "),"look"==this.$route.params.key?i("h2",[e._v("查看角色")]):e._e(),e._v(" "),i("div",{staticClass:"content-div"},[i("div",[i("div",[i("span",[e._v("角色名称")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.roleName,expression:"roleName"}],attrs:{type:"text"},domProps:{value:e.roleName},on:{input:function(t){t.target.composing||(e.roleName=t.target.value)}}})]),e._v(" "),i("div",[i("span",[e._v("角色说明")]),e._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.roleDescription,expression:"roleDescription"}],attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.roleDescription},on:{input:function(t){t.target.composing||(e.roleDescription=t.target.value)}}})]),e._v(" "),i("div",[i("span",[e._v("角色权限")]),e._v(" "),i("span",{staticClass:"permission-specification"},[i("el-tree",{ref:"tree",attrs:{data:e.data2,"show-checkbox":"","node-key":"id","default-expanded-keys":[1,2,3,4],"default-checked-keys":e.selectedPermission,props:e.defaultProps}})],1)]),e._v(" "),i("div",[i("span",[e._v("标准价格")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.standardPrice,expression:"standardPrice"}],attrs:{type:"text"},domProps:{value:e.standardPrice},on:{input:function(t){t.target.composing||(e.standardPrice=t.target.value)}}})]),e._v(" "),i("div",[i("span",[e._v("续费价格")]),e._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.renewPrice,expression:"renewPrice"}],attrs:{type:"text"},domProps:{value:e.renewPrice},on:{input:function(t){t.target.composing||(e.renewPrice=t.target.value)}}})])])]),e._v(" "),i("div",{staticClass:"btns"},["add"==this.$route.params.key?i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRole()}}},[e._v("确定")]):e._e(),e._v(" "),"modify"==this.$route.params.key?i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.modifyRole()}}},[e._v("确定")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"info"},on:{click:function(t){return e.goBack()}}},[e._v("取消")])],1)])},staticRenderFns:[]};var d=i("VU/8")(o,n,!1,function(e){i("cVov")},"data-v-2282d09a",null);t.default=d.exports}});
//# sourceMappingURL=9.5cee86b58cd2d053b4af.js.map